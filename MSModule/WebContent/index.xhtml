<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:ror="http://richfaces.org/rich"
	xmlns:roa="http://richfaces.org/a4j"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:mbui="http://metabosite.org/mbui">

<h:head>
	<meta charset="UTF-8" />
	<title>#{MODULE_RB.NAME}</title>
	<link rel="stylesheet" type="text/css"
		href="#{resource['css:module.css']}" />
	<link type="text/css" href="#{resource['css:base.css']}"
		rel="stylesheet" />
	<link type="text/css" href="#{resource['css:ForceDirected.css']}"
		rel="stylesheet" />

</h:head>
<h:body onload="init();">
	<div id="content">
		<div id="left">
			<mbui:menu items="#{moduleController.menuItems}">
				<h:panelGrid columns="3" style="width: 100%;" id="files_panel">
					<ror:panel style="min-width: 430px;">
						<f:facet name="header">
							<h:outputText value="#{Files_RB.treePanelHeader}" />
						</f:facet>

						<h:form>
							<roa:commandButton value="#{Files_RB.addDir}"
								rendered="#{utilisateurController.accessTo('MANAGER')}"
								render="files_panel"
								actionListener="#{fileSystemController.rootSelection()}">

								<ror:componentControl target="addDir" operation="show"
									event="begin" />
							</roa:commandButton>
						</h:form>
						<roa:outputPanel ajaxRendered="true">
							<h:outputText rendered="#{fileSystemController.roots.isEmpty()}"
								value="#{Files_RB.noDir}" />
						</roa:outputPanel>

						<h:form id="files_tree_form">
							<ror:tree id="files_tree" selectionType="ajax"
								selectionChangeListener="#{fileSystemController.selectionChanged}"
								var="item" nodeType="#{item.type}">

								<roa:ajax event="selectionchange" render="files_panel" />
								<roa:ajax event="click"
									listener="#{fileSystemController.resetSelection()}"
									render="files_panel" />

								<ror:treeModelRecursiveAdaptor
									roots="#{fileSystemController.roots}"
									nodes="#{item.directories}">
									<ror:treeNode id="dirNode" type="DIR"
										onclick="var n=#{ror:component('dirNode')};if (!n.isExpanded()) n.toggle()"
										iconCollapsed="#{fileSystemController.dirIcon(item.isRoot())}"
										iconExpanded="#{fileSystemController.dirIcon(item.isRoot())}"
										onmouseover="if (#{ror:element('dirFile')}) #{ror:element('dirFile')}.style.display = 'inline';"
										onmouseout="if (#{ror:element('dirFile')}) #{ror:element('dirFile')}.style.display = 'none';">

										<h:form>
											<h:outputText value="#{item.shortPath}" />


											<roa:outputPanel id="dirFile" style="display: none;"
												rendered="#{utilisateurController.accessTo('MANAGER')}">

												<h:outputText value=" [ " />
												<roa:commandLink value="#{Files_RB.addDirLink}"
													actionListener="#{fileSystemController.resetSelection()}">

													<ror:componentControl target="addDir" operation="show"
														event="begin" />
												</roa:commandLink>
												<h:outputText value=" | " />
												<roa:commandLink value="#{Files_RB.addFilesLink}"
													actionListener="#{fileSystemController.resetSelection()}">

													<ror:componentControl target="addFile" operation="show"
														event="begin" />
												</roa:commandLink>
												<h:outputText value=" | " />
												<roa:commandLink value="#{Files_RB.rmFilesLink}"
													actionListener="#{fileSystemController.resetSelection()}">

													<ror:componentControl target="rmDir" operation="show"
														event="begin" />
												</roa:commandLink>
												<h:outputText value=" ] " />
											</roa:outputPanel>
										</h:form>
									</ror:treeNode>

									<ror:treeNode type="FILE" expanded="#{true}"
										iconExpanded="#{fileSystemController.iconLeaf(item)}"
										onmouseover="if (#{ror:element('dirFileLeaf')}) #{ror:element('dirFileLeaf')}.style.display = 'inline';"
										onmouseout="if (#{ror:element('dirFileLeaf')}) #{ror:element('dirFileLeaf')}.style.display = 'none';">

										<h:form>
											<h:panelGrid columns="4"
												columnClasses="noborder, noborder, noborder, noborder">


												<h:outputText value="#{item.shortPath}" />


												<roa:outputPanel id="dirFileLeaf" style="display: none;"
													rendered="#{utilisateurController.accessTo('MANAGER')}">

													<roa:commandLink value=" × " style="text-decoration: none;"
														actionListener="#{fileSystemController.resetSelection()}">
														<ror:componentControl target="rmDir" operation="show"
															event="begin" />
													</roa:commandLink>
												</roa:outputPanel>
											</h:panelGrid>
										</h:form>
									</ror:treeNode>
								</ror:treeModelRecursiveAdaptor>
							</ror:tree>
						</h:form>
					</ror:panel>
					<h:panelGroup>

						<roa:outputPanel ajaxRendered="true">

							<ror:panel
								rendered="#{fileSystemController.existsOldSelection() and
										 fileSystemController.firstSelection.appPath.length() > 0}">
								<f:facet name="header">
									<h:outputText
										value="#{Files_RB.nodeDetailsPanelHeader} - « #{fileSystemController.firstSelection.shortPath} »" />
								</f:facet>
								<roa:outputPanel ajaxRendered="true"
									rendered="#{fileSystemController.firstSelection != null}">

									<h:outputText value="#{Files_RB.siteuser}"
										rendered="#{utilisateurController.accessTo('MANAGER')}" />
									<h:outputText value=" "
										rendered="#{utilisateurController.accessTo('MANAGER')}" />
									<h:outputText
										value="#{fileSystemController.firstSelection.details.siteuser.login}"
										style="text-decoration: underline"
										rendered="#{utilisateurController.accessTo('MANAGER')}" />
									<h:outputText value=" "
										rendered="#{utilisateurController.accessTo('MANAGER')}" />
									<h:outputText
										value="#{fileSystemController.firstSelection.details.siteuser.login}"
										style="text-decoration: underline"
										rendered="#{utilisateurController.accessTo('MANAGER')}" />
									<h:outputText value=", "
										rendered="#{utilisateurController.accessTo('MANAGER')}" />
									<h:outputText value="#{Files_RB.date}"
										rendered="#{utilisateurController.accessTo('MANAGER')}" />
									<h:outputText value=" "
										rendered="#{utilisateurController.accessTo('MANAGER')}" />

									<h:panelGroup
										rendered="#{fileSystemController.firstSelection.type == 'FILE'}">
										<br />
										<br />
										<h:outputText value="#{Files_RB.sizeOfFile} " />
										<h:outputText
											value="#{fileSystemController.firstSelection.size}" />
									</h:panelGroup>

									<h:panelGroup
										rendered="#{fileSystemController.firstSelection.type == 'FILE'}">
										<br />
										<h:outputLink value="#{global.contextRoot()}/dl">
											<f:param name="id"
												value="#{fileSystemController.firstSelection.details.fileLocation}" />
											<h:outputText value="#{Files_RB.download}" />
										</h:outputLink>
									</h:panelGroup>



									<hr />
									<h:graphicImage style="float: right;"
										onclick="
				                    	var sdc = #{ror:element('sel_description_change')};
				                    	var sd = #{ror:element('sel_description')};
				                    	if (sdc.style.display == 'none') {
					                    	sdc.style.display = 'block';
			                            	sd.style.display = 'none'
		                            	} else {
			                            	sdc.style.display = 'none';
			                            	sd.style.display = 'block';
		                            	}"
										value="/resources/img/edit.png" />
									<br />
									<roa:outputPanel id="sel_description">
										<h:outputText converter="brConverter" escape="false"
											value="#{fileSystemController.firstSelection.details.fileDescription}" />
									</roa:outputPanel>

									<roa:outputPanel>

										<h:form id="sel_description_change" style="display: none">
											<h:inputTextarea id="sel_description_change_ta"
												onblur="#{ror:element('sel_description_change')}.style.display = 'none';
			                            		#{ror:element('sel_description')}.style.display = 'block'"
												value="#{fileSystemController.firstSelection.details.fileDescription}">

												<roa:ajax event="blur" render="sel_description"
													listener="#{fileSystemController.changeDescListener()}" />
											</h:inputTextarea>
										</h:form>

									</roa:outputPanel>

									<hr />

								</roa:outputPanel>
							</ror:panel>
						</roa:outputPanel>
					</h:panelGroup>
				</h:panelGrid>
			</mbui:menu>
			<mbui:optionsPanel options="#{moduleController.mesOptions}">
				<mbui:option name="name" value="val" />
			</mbui:optionsPanel>
		</div>
		<mbui:modSpace title="#{MODULE_RB.NAME}">
			<h:form>
				<rich:calendar />
				<a4j:commandLink value="Lancer l'analyse" />
			</h:form>
			<div id="center-container">
				<div id="infovis"></div>
			</div>
			<div id="right-container">

				<div id="inner-details"></div>

			</div>

			<div id="log"></div>
		</mbui:modSpace>
	</div>
	<h:outputScript name="jit.js" />
	<h:outputScript name="script.js" />
</h:body>
</html>